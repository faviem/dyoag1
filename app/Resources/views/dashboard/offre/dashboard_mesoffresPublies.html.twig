{% extends 'market.html.twig' %}

{% block container %}
    <section class="add-buttons button-right hidden-phone hidden-tablet">
        <a class="itemadd" href="{{ path('dashboard_newoffrebrouillon') }}" id='vente-btn'>
            <span class="add-icon">
                <span class="add-text">Ajoutez un brouillon</span>
            </span>
        </a>

    </section>

    <section >
        <!--Swiper-->
        <div class="swiper-container">
            <div class="jumbotron text-center">
                <h1>
                    <span class="text-bold dyo-blue" >Mes Offres</span>
                </h1>
                <p class="big"></p>
            </div>
        </div>
    </section>
    <section class="section-border text-center text-md-left">
        <div class="container">
            {% block  menuentete %}
                <!--Tabs-->
                <ul class="nav nav-tabs text-center product" role="tablist" id="myTabs">
                    <li class="round-large text-dark-variant-3" role="presentation">
                        <a class="round-large" role="tab" aria-controls="tab0" href="{{ path('dashboard_mesoffresPublies')}}">
                            {{  publies|number_format(0, ',', '.') }} <i class="fa fa-share-alt"> </i>    Publications </a>
                    </li>
                    <li class="round-large text-dark-variant-3" role="presentation">
                        <a class="round-large" role="tab" aria-controls="tab1" href="{{ path('dashboard_mesoffresBrouillons')}}">
                            {{ brouillons|number_format(0, ',', '.') }} <i class="fa fa-book"> </i>     Brouillons </a>
                    </li>
                    <li class="round-large text-dark-variant-3" role="presentation">
                        <a class="round-large" role="tab" aria-controls="tab2" href="{{ path('dashboard_mesoffresExpires')}}">
                            {{ expires|number_format(0, ',', '.') }}  <i class="fa fa-calendar"> </i>  Expirées  </a>
                    </li>
                    <li class="round-large text-dark-variant-3" role="presentation">
                        <a class="round-large" role="tab" aria-controls="tab3" href="{{ path('dashboard_mesoffresResolus')}}">
                            {{ resolus|number_format(0, ',', '.') }}  <i class="fa fa-desktop"> </i>  Résolues </a>
                    </li>
                    <li class="round-large text-dark-variant-3" role="presentation">
                        <a class="round-large" role="tab" aria-controls="tab4" href="{{ path('dashboard_mesoffresCorbeille')}}">
                            {{ corbeille|number_format(0, ',', '.') }} <i class="fa fa-trash-o"> </i>  Corbeille </a>
                    </li>
                </ul>
            {% endblock %}
        </div>
    </section>
    <section class="text-center offset-1">
        <div class="container">
            {% set compte=0%}
            {% block  corps %}
                {% for element in ventes %}
                    {% set compte=compte+1 %}
                    {% set qte=0 %}{% set nbre=0%}
                    {% for souscrptions in element.orders %}
                        {% if souscrptions.canceled==0 and souscrptions.deleted==0 %}
                            {% set nbre=nbre+1 %}
                            {% if  souscrptions.approuved==1 and souscrptions.accepted==1 %}
                                {% set qte=qte+souscrptions.quantite %}
                            {% endif %}

                        {% endif %}
                    {% endfor %}

                    <div class="col-xs-6  col-md-3">
                        <div class="product tumbnail thumbnail-3">
                            <a href="{{ path('vente_show', { 'id': element.id }) }}">
                                <img class="img-circle" alt="" src="{{ asset(product_images ~'/'~ element.imageName)|imagine_filter('my_thumb') }}">
                            </a>
                            <div class="caption">
                                <h6>
                                    <a href="{{ path('vente_show', { 'id': element.id }) }}">{{ element.product.name }}</a>
                                </h6>
                                <i class="fa fa-money" aria-hidden="true"></i> <span class="price sale" style="font-size: 13px;color: #005074;">{{ element.prixUnit|number_format(0, ',', '.') }} FCFA / {{ element.measure }}</span>
                                <br>
                                <span class="stock" style="font-size: 13px;color: black;">{{ (element.quantite-qte)|number_format(0, ',', '.') }} {{ element.measure }}s en stock. </span>
                                <dl>
                                    <dt style="font-size: 13px;color: black;">  <i class="fa fa-calendar" aria-hidden="true"> </i> {{ element.createat|date('d M y') }}</dt>
                                </dl><br/>

                                <a title="Consulter les commandes" href="{{ path('dashboard_commandesoffre', { 'id': element.id }) }}">  {{ nbre|number_format(0, ',', '.') }}  <i class="fa fa-hand-o-right" > </i> Commandes  </a>
                                
                                {% if  nbre<=0 %} 
                                    —
                                    <a class="btn btn-default round-xl btn-xs" data-toggle="modal" data-target="#{{ element.id }}" href="#" title="Annuler l'offre"> <i class="fa fa-trash-o" > </i> 
                                    </a>
                                    <form  action="{{ path('dashboard_annuleroffre', { 'id': element.id }) }}" method="post"  >
                                        <!-- Modal -->
                                        <div class="modal fade" id="{{ element.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                        <h6 class="modal-title" id="myModalLabel">ANNULATION DE L'OFFRE </h6>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="col-xs-6  col-md-3">
                                                            <img class="img-circle img-sm" alt="" src="{{ asset(product_images ~'/'~ element.imageName)|imagine_filter('my_thumb') }}">
                                                        </div>
                                                        <span class="stock" style="color: black;text-align: left;">{{ (element.quantite-qte)|number_format(0, ',', '.') }} {{ element.measure }}s. Prix : {{ element.prixUnit|number_format(0, ',', '.') }} FCFA / {{ element.measure }}  </span>
                                                        <br/>
                                                        <div class="form-group">
                                                            <textarea class="form-control" id="exampleTextarea" rows="3" name="canceledReason" placeholder="Entrer le motif de l'annulation de l'offre ici" required="true"></textarea>
                                                        </div>
                                                        <i class="fa fa-trash-o" > </i>   Confirmez - vous l'annulation de l'offre du marché ?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default round-xl btn-xs" data-dismiss="modal">Non</button>
                                                        <button type="submit" class="btn btn-primary round-xl btn-xs">Oui</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                    </form>
                                {% endif %}

                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if compte==0 %}
                    <div class="col-xs-6  col-md-12 text-center" style="min-height: 280px;">
                        <div class="product tumbnail thumbnail-3">
                            <a class="btn btn-default round-xl btn-xs" href="#" > AUCUN OFFRE N'A ETE PUBLIE ... </a>
                        </div>
                    </div>
                {% endif %}
            {% endblock  corps %}

            <!-- Button trigger modal -->
        </div>
    </section>
{% endblock  %}
{% block javascripts %}
    {{ parent() }}
    <script>
        require(['dashboard/mesoffres']);
    </script>
{% endblock %}

